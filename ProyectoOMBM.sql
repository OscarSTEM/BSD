DROP SCHEMA IF EXISTS MMORPG;
CREATE SCHEMA MMORPG;
USE MMORPG;
CREATE TABLE JUGADOR(
ID INT PRIMARY KEY AUTO_INCREMENT,
NOMBRE_USUARIO VARCHAR (50) UNIQUE,
FECHA_NACIMIENTO DATETIME,
CONTRASENIA VARCHAR (30),
EMAIL VARCHAR (50) UNIQUE,
FECHA_HORA_REGISTRO DATETIME, 
FECHA_HORA_ULTIMO_ACCESO DATETIME,
CONSTRAINT FECHA_NACIMIENTO CHECK (FECHA_NACIMIENTO < "2023-12-01"),
CONSTRAINT EMAIL_VALIDO CHECK (EMAIL RLIKE "^[a-zA-Z0-9._%+-]+@(GMAIL|HOTMAIL|OUTLOOK)\\.(COM|ES)$"),
CONSTRAINT FECHA_HORA_ULTIMO_ACCESO CHECK (FECHA_HORA_ULTIMO_ACCESO >= FECHA_HORA_REGISTRO)
);
INSERT INTO JUGADOR VALUES
(DEFAULT,"KAOS","1998-12-01","KAOS123456","KAOSFORCE@GMAIL.COM","2020-12-01 16:40","2021-10-12 19:00"),
(DEFAULT,"JEQUE","1998-05-06","JEQQUE123789","JEQUE13@GMAIL.COM","2021-10-05 17:20","2022-05-10 18:30"),
(DEFAULT,"JASON","1999-02-03","JASON031214","JASONMARK@GMAIL.COM","2019-08-02 12:50","2020-08-10 13:50");
SELECT * FROM JUGADOR;

CREATE TABLE LUGAR(
NOMBRE VARCHAR (50) PRIMARY KEY,
DESCRIPCION VARCHAR (50) 
);
INSERT INTO LUGAR VALUES
("Hobbiton","LUGAR DONDE VIVEN LOS HOBBITS"),
("ABISMO DE HELM","FORTALEZA DE ROHAN"),
("MINAS TIRITH","FORTALEZA DE GONDOR");
SELECT * FROM LUGAR;

CREATE TABLE PERSONAJE(
ID INT PRIMARY KEY AUTO_INCREMENT,
NOMBRE VARCHAR (30),
NIVEL INT NOT NULL DEFAULT 0,
EXPERIENCIA INT NOT NULL DEFAULT 0,
CLASE VARCHAR (50),
RAZA VARCHAR (50) ,
FUERZA INT NOT NULL DEFAULT 10, 
CONSTITUCION VARCHAR (30) NOT NULL,
DESTREZA INT NOT NULL DEFAULT 10,
INTELIGENCIA INT NOT NULL DEFAULT 10,
SABIDURIA INT NOT NULL DEFAULT 10,
CARISMA INT NOT NULL DEFAULT 10,
ID_JUGADOR INT, 
NOMBRE_LUGAR VARCHAR (50) NOT NULL,
FOREIGN KEY(ID_JUGADOR)REFERENCES JUGADOR(ID),
FOREIGN KEY (NOMBRE_LUGAR) REFERENCES LUGAR(NOMBRE),
CONSTRAINT FUERZA CHECK (FUERZA >=8 AND FUERZA <=20),
CONSTRAINT DESTREZA CHECK (DESTREZA >= 8 AND DESTREZA <= 20),
CONSTRAINT SABIDURIA CHECK (SABIDURIA >= 8 AND SABIDURIA <= 20),
CONSTRAINT CARISMA CHECK (CARISMA >= 8 AND CARISMA <= 20)
);
INSERT INTO PERSONAJE VALUES
("1","LEGOLAS",DEFAULT,DEFAULT,"ARQUERO","ELFO",DEFAULT,"DELGADO",DEFAULT,DEFAULT,DEFAULT,DEFAULT,"1","HOBBITON"),
("2","ARAGORN",DEFAULT,DEFAULT,"GUERRERO","DUNEDAIN",DEFAULT,"FUERTE",DEFAULT,DEFAULT,DEFAULT,DEFAULT,"2","MINAS TIRITH"),
("3","GIMLI",DEFAULT,DEFAULT,"GUERRERO","ENANO",DEFAULT,"RELLENO",DEFAULT,DEFAULT,DEFAULT,DEFAULT,"3","ABISMO DE HELM");
SELECT * FROM PERSONAJE;

CREATE TABLE OBJETO(
ID INT PRIMARY KEY AUTO_INCREMENT,
NOMBRE VARCHAR (50),
TIPO VARCHAR (50),
RAREZA VARCHAR (50),
PRECIO INT ,
DESCRIPCION VARCHAR (50),
IMAGEN BLOB,
CONSTRAINT PRECIO CHECK (PRECIO >= 1 AND PRECIO <= 9999)
);
INSERT INTO OBJETO VALUES
("1","ARCO","ELFICO","NORMAL","16","ARCO HECHO POR LOS MISMOS ELFOS",""),
("2","ESPADA","ELFICO","LEGENDARIA","20","ESPADA DESCENDIENTE DE RIVENDEL",""),
("3","HACHA","ENANO","RARA","50","FABRICADA EN MORIA","");
SELECT * FROM OBJETO;


CREATE TABLE MOBS(
ID INT PRIMARY KEY AUTO_INCREMENT,
NOMBRE VARCHAR (50),
TIPO VARCHAR (50),
NIVEL INT,
PUNTOS_VIDA INT,
PUNTOS_ATAQUE INT,
TIEMPO_REAPARICION TIME,
INMORTAL BOOLEAN,
RECOMPENSA INT,
CONSTRAINT TIEMPO_REAPARICION CHECK (TIEMPO_REAPARICION >=15)
);
INSERT INTO MOBS VALUES
("1","LURTZ","ELFO OSCURO","10","50","20","16",FALSE,"150"),
("2","SAURON","NIGROMANTE","10","20","20","20",FALSE,"200"),
("3","SARUMAN","MAGO","10","50","20","20",FALSE,"250");
SELECT * FROM MOBS;

CREATE TABLE REGION(
NOMBRE VARCHAR (50) PRIMARY KEY,
DESCRIPCION VARCHAR (50),
NIVEL_RECOMENDADO INT
);
INSERT INTO REGION VALUES
("NORTE", "NORTE DE GONDOR","20"),
("SUR","SUR DE ROHAN", "10"),
("OESTE","OESTE DEL VALLE","5");
SELECT * FROM REGION;

CREATE TABLE MISION(
ID INT PRIMARY KEY AUTO_INCREMENT,
NOMBRE VARCHAR (50),
DESCRIPCION VARCHAR (50),
RECOMPENSA INT,
REQUISITO_NIVEL INT,
NOMBRE_REGION VARCHAR (50),
FOREIGN KEY (NOMBRE_REGION) REFERENCES REGION(NOMBRE)
);
INSERT INTO MISION VALUES
("1", "CABEZA DE PUERCO","MATA AL ORCO APODADO PUERCO", "50","1","NORTE"),
("2","CAZARECOMPENSAS", "MATA AL LIDER ORCO","100","10","SUR"),
("3","MENTE FRIA","TOMA UNA DECISION DIFICIL","120","5","OESTE");
SELECT * FROM MISION;

CREATE TABLE LUGAR_CAMPO_ABIERTO(
BIOMA VARCHAR (30), 
NOMBRE_LUGAR VARCHAR (50),
PRIMARY KEY (NOMBRE_LUGAR),
FOREIGN KEY (NOMBRE_LUGAR) REFERENCES LUGAR(NOMBRE)
);
INSERT INTO LUGAR_CAMPO_ABIERTO VALUES
("DESERTICO", "HOBBITON"),
("ROCOSO","ABISMO DE HELM"),
("ARIDO","MINAS TIRITH");
SELECT * FROM LUGAR_CAMPO_ABIERTO;

CREATE TABLE LUGAR_CIUDAD(
TAMAÃ‘O_CIUDAD TEXT, 
NOMBRE_LUGAR VARCHAR (50),
PRIMARY KEY (NOMBRE_LUGAR),
FOREIGN KEY (NOMBRE_LUGAR) REFERENCES LUGAR(NOMBRE)
);
INSERT INTO LUGAR_CIUDAD VALUES
("MEDIANO", "HOBBITON"),
("GRANDE","ABISMO DE HELM"),
("GRANDE","MINAS TIRITH");
SELECT * FROM LUGAR_CIUDAD;
CREATE TABLE LUGAR_ZONA(
NOMBRE VARCHAR (50),
DESCRIPCION VARCHAR (50),
NOMBRE_LUGAR VARCHAR (50),
PRIMARY KEY (NOMBRE_LUGAR),
FOREIGN KEY (NOMBRE_LUGAR) REFERENCES LUGAR(NOMBRE)
);
INSERT INTO LUGAR_ZONA VALUES
("CAMPOS DE HOBBITON", "CAMPO","HOBBITON"),
("LLANURAS DEL SUR","LLANURA","ABISMO DE HELM"),
("CAMPOS DE PELENNOR","CAMPO","MINAS TIRITH");
SELECT * FROM LUGAR_ZONA;

CREATE TABLE LUGAR_MAZMORRA(
CANTIDAD_ENTRADAS INT,
CANTIDAD_SALIDAS INT,
NOMBRE_LUGAR VARCHAR (50),
PRIMARY KEY (NOMBRE_LUGAR),
FOREIGN KEY (NOMBRE_LUGAR) REFERENCES LUGAR(NOMBRE)
);
INSERT INTO LUGAR_MAZMORRA VALUES
("1", "1","HOBBITON"),
("1","2","ABISMO DE HELM"),
("1","1","MINAS TIRITH");
SELECT * FROM LUGAR_MAZMORRA;

CREATE TABLE LUGAR_PLANTA(
NUMERO_PLANTA INT,
DESCRIPCION VARCHAR (50),
NOMBRE_LUGAR VARCHAR (50),
PRIMARY KEY (NOMBRE_LUGAR),
FOREIGN KEY (NOMBRE_LUGAR) REFERENCES LUGAR (NOMBRE)
);
INSERT INTO LUGAR_PLANTA VALUES
("10", "BOLSON CERRADO","HOBBITON"),
("0","PUERTAS DEL ABISMO","ABISMO DE HELM"),
("0","PUERTAS DEL MURO","MINAS TIRITH");
SELECT * FROM LUGAR_PLANTA;

CREATE TABLE LUGAR_HABITACION(
NUMERO_PLANTA INT,
NUMERO_ENEMIGOS_DENTRO INT,
DESCRIPCION VARCHAR (50), 
NOMBRE_LUGAR VARCHAR (50),
PRIMARY KEY (NOMBRE_LUGAR),
FOREIGN KEY (NOMBRE_LUGAR) REFERENCES LUGAR (NOMBRE)
);
INSERT INTO LUGAR_HABITACION VALUES
("10", "2","HAY LOBOS EN LA COMARCA","HOBBITON"),
("0","100","EJERCITO DE URUKS HAI","ABISMO DE HELM"),
("0","100","ORCOS","MINAS TIRITH");
SELECT * FROM LUGAR_HABITACION;

CREATE TABLE NPC(
ID INT PRIMARY KEY AUTO_INCREMENT, 
NOMBRE VARCHAR (50), 
LINEAS_DIALOGO TINYTEXT, 
NOMBRE_LUGAR VARCHAR (50),
FOREIGN KEY(NOMBRE_LUGAR) REFERENCES LUGAR(NOMBRE)
);
INSERT INTO NPC VALUES
("1", "TOM BOMBADIL","20","HOBBITON"),
("2","ELROND","100","ABISMO DE HELM"),
("3","RADAGAST","50","MINAS TIRITH");
SELECT * FROM NPC;

CREATE TABLE NPC_ARTESANO(
HABILIDAD_FABRICACION VARCHAR (50),
PRECIO_FABRICACION FLOAT,
OBJETO_FABRICADO VARCHAR (50), 
ID_NPC INT,
PRIMARY KEY (ID_NPC),
FOREIGN KEY (ID_NPC) REFERENCES NPC(ID)
);
INSERT INTO NPC_ARTESANO VALUES
("ALTA", "50","ESPADA","1"),
("MEDIA","40","HACHA","2"),
("ALTA","30","DARDO","3");
SELECT * FROM NPC;
CREATE TABLE NPC_COMERCIANTE(
ORO_DISPONIBLE FLOAT,
OBJETO_VENDE VARCHAR (50),
CANTIDAD_DISPONIBLE INT,
PRECIO_OBJETO FLOAT, 
ID_NPC INT,
PRIMARY KEY (ID_NPC),
FOREIGN KEY (ID_NPC) REFERENCES NPC(ID)
);
INSERT INTO NPC_COMERCIANTE VALUES
("50", "ESPADA","2","20","1"),
("50","ARCO","3","20","2"),
("50","DARDO","2","30","3");
SELECT * FROM NPC_COMERCIANTE;
CREATE TABLE CLAN(
NOMBRE_CLAN VARCHAR (50) PRIMARY KEY,
MIEMBROS INT,
LIDER_CLAN VARCHAR (50),
DESCRIPCION_CLAN VARCHAR (50),
ID_NPC INT,
FOREIGN KEY (ID_NPC) REFERENCES NPC(ID)
);
INSERT INTO CLAN VALUES
("KAOSRESIGN", "20","ARAGORN","GUERREROS","1"),
("GONDOLIER","15","LEGOLAS","ARQUEROS","2"),
("EDORAS","30","ELROND","ELFOS","3");
SELECT * FROM CLAN;

CREATE TABLE LUGAR_CONECTA_LUGAR(
NOMBRE_LUGAR_1 VARCHAR (50), 
NOMBRE_LUGAR_2 VARCHAR (50),
PRIMARY KEY (NOMBRE_LUGAR_1,NOMBRE_LUGAR_2),
FOREIGN KEY (NOMBRE_LUGAR_1) REFERENCES LUGAR(NOMBRE),
FOREIGN KEY (NOMBRE_LUGAR_2) REFERENCES LUGAR(NOMBRE)
); 
INSERT INTO LUGAR_CONECTA_LUGAR VALUES
("HOBBITON","MINAS TIRITH"),
("MINAS TIRITH","ABISMO DE HELM"),
("ABISMO DE HELM","HOBBITON");
SELECT * FROM LUGAR_CONECTA_LUGAR;

CREATE TABLE REGION_CONECTA_REGION(
NOMBRE_REGION_1 VARCHAR (50),
NOMBRE_REGION_2 VARCHAR (50),
PRIMARY KEY (NOMBRE_REGION_1,NOMBRE_REGION_2),
FOREIGN KEY (NOMBRE_REGION_1) REFERENCES REGION(NOMBRE),
FOREIGN KEY (NOMBRE_REGION_2) REFERENCES REGION(NOMBRE)
);
INSERT INTO REGION_CONECTA_REGION VALUES
("NORTE","SUR"),
("SUR","OESTE"),
("OESTE","NORTE");
SELECT * FROM REGION_CONECTA_REGION;

CREATE TABLE JUGADOR_CONOCE_ESTADO_MISION(
ID_JUGADOR INT,
ID_MISION INT,
ESTADO TEXT, 
FECHA DATE,
PRIMARY KEY (ID_JUGADOR,ID_MISION,FECHA),
FOREIGN KEY (ID_JUGADOR) REFERENCES JUGADOR(ID),
FOREIGN KEY (ID_MISION) REFERENCES MISION(ID),
CONSTRAINT ESTADO_MISION CHECK (ESTADO = "COMPLETADA" OR ESTADO = "ACTIVA" OR ESTADO = "FALLIDA")
);
INSERT INTO JUGADOR_CONOCE_ESTADO_MISION VALUES
("1","1","ACTIVA","2021-12-20"),
("2","2","FALLIDA","2019-10-20"),
("3","3","COMPLETADA","2020-10-20");
SELECT * FROM JUGADOR_CONOCE_ESTADO_MISION;

CREATE TABLE PERSONAJE_ATACA_MOB(
ID_JUGADOR INT,
ID_MOBS INT,
FECHA_HORA DATETIME,
ELIMINADO BOOLEAN,
PRIMARY KEY (ID_JUGADOR,ID_MOBS,FECHA_HORA),
FOREIGN KEY (ID_JUGADOR) REFERENCES JUGADOR(ID),
FOREIGN KEY (ID_MOBS) REFERENCES MOBS(ID)
);
INSERT INTO PERSONAJE_ATACA_MOB VALUES
("1","1","2020-12-01 16:40",TRUE),
("2","2","2020-12-01 16:40",TRUE),
("3","3","2020-12-01 16:40",TRUE);
SELECT * FROM PERSONAJE_ATACA_MOB;

CREATE TABLE PERSONAJE_DISPONE_INVENTARIO_OBJETO(
ID_PERSONAJE INT,
ID_OBJETO INT,
CANTIDAD INT CHECK (CANTIDAD >=0),
PRIMARY KEY (ID_PERSONAJE,ID_OBJETO),
FOREIGN KEY (ID_PERSONAJE) REFERENCES PERSONAJE(ID)
);
INSERT INTO PERSONAJE_DISPONE_INVENTARIO_OBJETO VALUES
("1","1","10"),
("2","2","16"),
("3","3","20");
SELECT * FROM PERSONAJE_DISPONE_INVENTARIO_OBJETO;

CREATE TABLE PERSONAJE_ATACA_PERSONAJE(
ID_PERSONAJE INT,
ID_PERSONAJE_1 INT,
FECHA_HORA DATETIME,
CANTIDAD_VIDA_QUITADA INT,
ELIMINADO BOOLEAN,
PRIMARY KEY (ID_PERSONAJE)
);
INSERT INTO PERSONAJE_ATACA_PERSONAJE VALUES
("1","1","2020-12-01 18:40", "20", TRUE),
("2","2","16","2020-12-01 19:40", "25", TRUE),
("3","3","20","2020-12-01 13:40", "20", TRUE);
SELECT * FROM PERSONAJE_ATACA_PERSONAJE;
CREATE TABLE OBJETO_VENDE_COMERCIANTE(
ID_OBJETO INT,
ID_NPC INT,
PRIMARY KEY(ID_OBJETO, ID_NPC),
FOREIGN KEY (ID_OBJETO) REFERENCES OBJETO(ID),
FOREIGN KEY (ID_NPC) REFERENCES NPC(ID)
);
INSERT INTO OBJETO_VENDE_COMERCIANTE VALUES
("1","1"),
("2","2"),
("3","3");
SELECT * FROM OBJETO_VENDE_COMERCIANTE;

CREATE TABLE OBJETO_FABRICA_ARTESANO(
ID_OBJETO INT,
ID_NPC INT,
PRIMARY KEY(ID_OBJETO, ID_NPC),
FOREIGN KEY (ID_OBJETO) REFERENCES OBJETO(ID),
FOREIGN KEY (ID_NPC) REFERENCES NPC(ID)
);
INSERT INTO OBJETO_FABRICA_ARTESANO VALUES
("1","1"),
("2","2"),
("3","3");
SELECT * FROM OBJETO_FABRICA_ARTESANO;

CREATE TABLE REGION_PERTENECE_LUGAR(
NOMBRE_REGION VARCHAR (50), 
NOMBRE_LUGAR VARCHAR (50),
PRIMARY KEY(NOMBRE_REGION,NOMBRE_LUGAR),
FOREIGN KEY (NOMBRE_REGION) REFERENCES REGION(NOMBRE),
FOREIGN KEY (NOMBRE_LUGAR) REFERENCES LUGAR(NOMBRE)
);
INSERT INTO REGION_PERTENECE_LUGAR VALUES
("NORTE","HOBBITON"),
("SUR","ABISMO DE HELM"),
("OESTE","MINAS TIRITH");
SELECT * FROM REGION_PERTENECE_LUGAR;

CREATE TABLE GUERRA(
ID_GUERRA INT PRIMARY KEY,
FECHA_INICIO DATE,
FECHA_FIN DATE,
CLAN_GANADOR VARCHAR (50),
ID_PERSONAJE INT,
NOMBRE_CLAN VARCHAR (50),
FOREIGN KEY (ID_PERSONAJE) REFERENCES PERSONAJE(ID),
FOREIGN KEY (NOMBRE_CLAN) REFERENCES CLAN(NOMBRE_CLAN),
CONSTRAINT FECHA_GUERRA CHECK (FECHA_FIN < FECHA_INICIO)
);
INSERT INTO GUERRA VALUES
("1","2020-10-17","2020-10-16","KAOSRESIGN","1","KAOSRESIGN"),
("2","2020-10-17","2020-10-16","GONDOLIER","2","GONDOLIER"),
("3","2020-10-17","2020-10-16","EDORAS","3","EDORAS");
SELECT * FROM GUERRA;
CREATE TABLE PERSONAJE_PARTICIPA_GUERRA(
ID_PERSONAJE INT,
NOMBRE_CLAN VARCHAR (50),
ID_GUERRA INT,
PRIMARY KEY(ID_PERSONAJE,NOMBRE_CLAN,ID_GUERRA),
FOREIGN KEY (ID_PERSONAJE) REFERENCES PERSONAJE(ID),
FOREIGN KEY (NOMBRE_CLAN)REFERENCES CLAN(NOMBRE_CLAN),
FOREIGN KEY (ID_GUERRA) REFERENCES GUERRA(ID_GUERRA)
);
INSERT INTO PERSONAJE_PARTICIPA_GUERRA VALUES
("1","KAOSRESIGN","1"),
("2","GONDOLIER","2"),
("3","EDORAS","3");
SELECT * FROM PERSONAJE_PARTICIPA_GUERRA;

CREATE TABLE PERSONAJE_COMPRA_OBJETO_COMERCIANTE(
CANTIDAD INT,
PRECIO FLOAT, 
ID_PERSONAJE INT,
ID_NPC INT,
ID_OBJETO INT,
PRIMARY KEY (ID_PERSONAJE,ID_NPC,ID_OBJETO),
FOREIGN KEY (ID_PERSONAJE) REFERENCES PERSONAJE(ID),
FOREIGN KEY (ID_NPC) REFERENCES NPC(ID),
FOREIGN KEY (ID_OBJETO) REFERENCES OBJETO(ID)
);
INSERT INTO PERSONAJE_COMPRA_OBJETO_COMERCIANTE VALUES
("20","15","1","1","1"),
("20","15","2","2","2"),
("15","10","3","3","3");
SELECT * FROM PERSONAJE_COMPRA_OBJETO_COMERCIANTE;

CREATE TABLE PERSONAJE_ATACA_OBJETO_A_MOBS(
ID_PERSONAJE INT,
ID_OBJETO INT,
ID_MOBS INT,
PRIMARY KEY (ID_PERSONAJE,ID_OBJETO,ID_MOBS),
FOREIGN KEY (ID_PERSONAJE) REFERENCES PERSONAJE(ID),
FOREIGN KEY (ID_OBJETO) REFERENCES OBJETO(ID),
FOREIGN KEY (ID_MOBS) REFERENCES MOBS(ID)
);
INSERT INTO  PERSONAJE_ATACA_OBJETO_A_MOBS VALUES
("1","1","1"),
("2","2","2"),
("3","3","3");
SELECT * FROM  PERSONAJE_ATACA_OBJETO_A_MOBS;